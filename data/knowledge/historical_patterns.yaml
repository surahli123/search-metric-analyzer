# data/knowledge/historical_patterns.yaml
# Known recurring patterns and past incidents for Enterprise Search.
# This is the "institutional memory" — the tribal knowledge encoded.

seasonal_patterns:
  - name: "Enterprise Onboarding Wave"
    trigger: "Large tenant batch onboarding"
    typical_impact:
      click_quality: [-0.02, -0.04]
      search_quality_success: [-0.01, -0.02]
    mechanism: >
      New tenants have sparse indexes (few connectors configured),
      dragging down aggregate metrics via mix-shift.
    duration_days: [14, 28]
    key_check: >
      Segment by tenant_age — if drop is concentrated in tenants < 30 days
      old, this is expected onboarding noise.
    recovery: "Metrics recover as new tenants configure more connectors (30-90 days)."

  - name: "AI Feature Batch Rollout"
    trigger: "Batch AI enablement for tenant cohort"
    typical_impact:
      click_quality: [-0.02, -0.04]
      ai_answer_rate: [+0.10, +0.20]
      search_quality_success: [+0.005, +0.015]
    mechanism: >
      Users get direct AI answers instead of clicking through to documents.
      Click Quality drops but Search Quality Success may improve. This is SUCCESS, not failure.
    key_check: >
      Always segment by ai_enablement. If drop is entirely in ai_on cohort
      and ai_answer_rate increased, this is a positive signal.
    is_positive: true

  - name: "Connector Outage Pattern"
    trigger: "Third-party connector service degradation"
    typical_impact:
      click_quality: [-0.02, -0.08]
      zero_result_rate: [+0.02, +0.10]
    mechanism: >
      If a connector goes down, queries needing that source return
      degraded or zero results.
    duration_days: [0.5, 3]
    key_check: >
      Segment by connector_type. Check connector health/sync status.
    diagnostic_shortcut: "Check connector health dashboard first — if status shows failure, skip decomposition."

  - name: "End of Quarter Surge"
    trigger: "Enterprise end-of-quarter (finance, compliance searches)"
    typical_impact:
      query_volume: [+0.15, +0.30]
      click_quality: [-0.005, -0.015]
    mechanism: >
      Quarter-end drives finance/compliance/strategy searches.
      These tend to be more exploratory, lower click-through.
      Mix-shift from query type composition change.
    key_check: "Check calendar alignment. Compare to same period last year."

  - name: "Weekend/Weekday Cycle"
    trigger: "Normal weekly usage pattern"
    typical_impact:
      query_volume: [-0.30, -0.50]
      click_quality: [+0.01, +0.02]
    mechanism: >
      Weekend has fewer queries, skewed toward power users who click more.
      Apparent Click Quality increase is mix-shift, not quality improvement.
    key_check: "Always compare same day-of-week (WoW), not consecutive days."

known_incidents:
  - date: "2025-11-15"
    type: "logging_anomaly"
    affected_metrics: [click_quality, search_quality_success]
    impact: -0.04
    root_cause: "Click tracking pipeline migration dropped 8% of events"
    resolution: "Pipeline rollback + backfill"
    data_signature:
      overnight_step_change: true
      all_segments_affected_equally: true
      data_completeness_drop: true
    lessons: "Always check tracking completeness before investigating quality."

  - date: "2025-09-22"
    type: "connector_outage"
    affected_metrics: [click_quality, zero_result_rate]
    impact: -0.03
    root_cause: "Confluence API rate limiting during large customer migration"
    resolution: "Rate limit increase + backfill"
    data_signature:
      concentrated_in_connector: "confluence"
      zero_result_spike: true
      gradual_onset: true

  - date: "2025-08-10"
    type: "model_regression"
    affected_metrics: [click_quality, search_quality_success]
    impact: -0.025
    root_cause: "L3 ranker retraining introduced position bias for tail queries"
    resolution: "Model rollback to previous version"
    data_signature:
      concentrated_in_tier: "standard"
      concentrated_in_position: "3-5"
      experiment_temporal_match: true

diagnostic_shortcuts:
  - name: "Connector health check"
    condition: "Connector health dashboard shows failures"
    action: "Jump directly to connector root cause — skip full decomposition"
    saves: "30-60 minutes of dimensional analysis"

  - name: "Model fallback rate"
    condition: "model_fallback_rate metric spiked"
    action: "Jump to serving/latency investigation"
    saves: "Skip hypothesis generation for non-infra causes"

  - name: "Single tenant dominance"
    condition: "One tenant accounts for >40% of the metric movement"
    action: "Jump to tenant-specific analysis"
    saves: "Avoid analyzing dimensions that are all driven by one tenant"

  - name: "Overnight step-change"
    condition: "Metric changed >2% between consecutive days with no gradual trend"
    action: "Check instrumentation/logging first (highest prior probability)"
    saves: "Logging bugs cause step-changes; quality regressions are usually gradual"
